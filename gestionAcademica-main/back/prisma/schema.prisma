generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum EstadoPractica {
  EN_CURSO   @map("En Curso")
  APROBADO   @map("Aprobado")
  REPROBADO  @map("Reprobado")
}

enum EstadoActividad {
  PENDIENTE
  APROBADA
  OBSERVADA
}

enum TipoCentro {
  PARTICULAR
  PARTICULAR_SUBVENCIONADO @map("PARTICULAR SUBVENCIONADO")
  SLEP
}

enum TipoTutor {
  Supervisor
  Tallerista
}

enum TipoPregunta {
  ABIERTA
  CERRADA
}

/////////////////////////////////
//     MODELOS PRINCIPALES
/////////////////////////////////

model Estudiante {
  rut                  String    @id
  nombre               String
  genero               String?
  anio_nacimiento      DateTime?
  anio_ingreso         Int?
  plan                 String?
  avance               Float?
  puntaje_ponderado    Float?
  puntaje_psu          Float?
  promedio             Float?
  fono                 Int?
  email                String?
  direccion            String?
  sistema_ingreso      String?
  numero_inscripciones Int?

  practicas Practica[]

  @@map("estudiante")
}

model Practica {
  id            Int             @id @default(autoincrement())
  estado        EstadoPractica
  fecha_inicio  DateTime
  fecha_termino DateTime?
  tipo          String?

  estudianteRut String
  estudiante    Estudiante      @relation(fields: [estudianteRut], references: [rut])

  centroId Int
  centro   CentroEducativo      @relation(fields: [centroId], references: [id])

  practicaColaboradores PracticaColaborador[]
  practicaTutores       PracticaTutor[]

  @@map("practica")
}

model CentroEducativo {
  id                      Int         @id @default(autoincrement())
  nombre                  String
  region                  String?
  comuna                  String?
  direccion               String?
  telefono                Int?
  correo                  String?
  tipo                    TipoCentro?
  convenio                String?
  url_rrss                String?
  fecha_inicio_asociacion DateTime?

  practicas    Practica[]
  trabajadores TrabajadorEduc[]

  @@map("centro_educativo")
}

model TrabajadorEduc {
  id       Int     @id @default(autoincrement())
  rut      String  @unique
  nombre   String
  rol      String?
  correo   String?
  telefono Int?

  centroId Int
  centro   CentroEducativo @relation(fields: [centroId], references: [id], onDelete: Cascade)

  @@map("trabajador_educ")
}

model Colaborador {
  id                 Int      @id @default(autoincrement())
  rut                String   @unique
  nombre             String
  correo             String?
  direccion          String?
  telefono           Int?
  universidad_egreso String?

  cargos                 Cargo[]
  practicaColaboradores  PracticaColaborador[]

  @@map("colaborador")
}

model Actividad {
  id               Int      @id @default(autoincrement())
  mes              String
  nombre_actividad String
  estudiantes      String?
  fecha            DateTime
  horario          String?
  lugar            String?
  archivo_adjunto  String?

  @@map("actividad")
}

model Usuario {
  id         Int    @id @default(autoincrement())
  nombre     String
  correo     String @unique
  rol        String
  contrasena String

  @@map("usuario")
}

/////////////////////////////////////
//    NUEVO MODELO: ENCUESTA SEMESTRE
/////////////////////////////////////

model EncuestaSemestre {
  id                      Int                      @id @default(autoincrement())
  anio                    Int
  semestre                Int
  archivo_adjunto         String?

  encuestasEstudiantes    EncuestaEstudiante[]
  encuestasColaboradores  EncuestaColaborador[]

  @@map("encuesta_semestre")
}

/////////////////////////////////////
//   ENCUESTAS A ESTUDIANTES
/////////////////////////////////////

model EncuestaEstudiante {
  id                 Int       @id @default(autoincrement())
  nombre_estudiante  String
  nombre_tallerista  String?
  nombre_centro      String?
  nombre_colaborador String?
  fecha              DateTime?
  observacion        String?

  semestreId Int?
  semestre   EncuestaSemestre? @relation(fields: [semestreId], references: [id], onDelete: Cascade)

  items      ItemEncuestaEstudiante[]
  respuestas RespuestaSeleccionada[]

  @@map("encuesta_estudiante")
}

model ItemEncuestaEstudiante {
  id         Int    @id @default(autoincrement())
  encuestaId Int
  titulo     String
  orden      Int?

  encuesta  EncuestaEstudiante @relation(fields: [encuestaId], references: [id], onDelete: Cascade)
  preguntas Pregunta[]

  @@map("item_encuesta_estudiante")
}

/////////////////////////////////////
//   ENCUESTAS A COLABORADORES
/////////////////////////////////////

model EncuestaColaborador {
  id                 Int      @id @default(autoincrement())
  nombre_colaborador String
  nombre_colegio     String?
  observacion        String?
  fecha              DateTime?
  
  semestreId Int?
  semestre   EncuestaSemestre? @relation(fields: [semestreId], references: [id], onDelete: Cascade)

  items      ItemEncuestaColaborador[]
  respuestas RespuestaSeleccionada[]

  @@map("encuesta_colaborador")
}

model ItemEncuestaColaborador {
  id         Int    @id @default(autoincrement())
  encuestaId Int
  titulo     String
  orden      Int?

  encuesta  EncuestaColaborador @relation(fields: [encuestaId], references: [id], onDelete: Cascade)
  preguntas Pregunta[]

  @@map("item_encuesta_colaborador")
}

/////////////////////////////////////
//   PREGUNTAS, ALTERNATIVAS Y RESPUESTAS
/////////////////////////////////////

model Pregunta {
  id               Int     @id @default(autoincrement())
  descripcion      String
  tipo             TipoPregunta
  respuestaAbierta String?

  itemEstudianteId  Int?
  itemEstudiante    ItemEncuestaEstudiante? @relation(fields: [itemEstudianteId], references: [id])

  itemColaboradorId Int?
  itemColaborador   ItemEncuestaColaborador? @relation(fields: [itemColaboradorId], references: [id])

  alternativas Alternativa[]
  respuestas   RespuestaSeleccionada[]

  @@map("pregunta")
}

model Alternativa {
  id          Int    @id @default(autoincrement())
  descripcion String
  puntaje     Int

  preguntaId Int
  pregunta   Pregunta @relation(fields: [preguntaId], references: [id])

  respuestas RespuestaSeleccionada[]

  @@map("alternativa")
}

///////////////////////////////
//   NUEVO MODELO: RESPUESTAS
///////////////////////////////

model RespuestaSeleccionada {
  id                    Int      @id @default(autoincrement())

  encuestaEstudianteId  Int?
  encuestaEstudiante    EncuestaEstudiante? @relation(fields: [encuestaEstudianteId], references: [id], onDelete: Cascade)

  encuestaColaboradorId Int?
  encuestaColaborador   EncuestaColaborador? @relation(fields: [encuestaColaboradorId], references: [id], onDelete: Cascade)

  preguntaId            Int
  pregunta              Pregunta @relation(fields: [preguntaId], references: [id])

  alternativaId         Int?
  alternativa           Alternativa? @relation(fields: [alternativaId], references: [id])

  respuestaAbierta      String?

  @@map("respuesta_seleccionada")
}

/////////////////////////////////////
//   PRACTICAS, CARGOS Y TUTORES
/////////////////////////////////////

model Tutor {
  id                 Int     @id @default(autoincrement())
  rut                String  @unique
  nombre             String
  correo             String?
  direccion          String?
  telefono           Int?
  universidad_egreso String?

  cargos          Cargo[]
  practicaTutores PracticaTutor[]

  @@map("tutor")
}

model CartaSolicitud {
  id               Int      @id @default(autoincrement())
  numero_folio     String   @unique
  fecha            DateTime
  direccion_emisor String?
  url_archivo      String?

  @@map("carta_solicitud")
}

model PracticaColaborador {
  practicaId    Int
  colaboradorId Int

  practica    Practica    @relation(fields: [practicaId], references: [id], onDelete: Cascade)
  colaborador Colaborador @relation(fields: [colaboradorId], references: [id], onDelete: Cascade)

  @@id([practicaId, colaboradorId])
  @@map("practica_colaborador")
}

model PracticaTutor {
  practicaId Int
  tutorId    Int
  rol        TipoTutor

  practica Practica @relation(fields: [practicaId], references: [id], onDelete: Cascade)
  tutor    Tutor    @relation(fields: [tutorId], references: [id], onDelete: Cascade)

  @@id([practicaId, tutorId])
  @@map("practica_tutor")
}

model Cargo {
  id    Int    @id @default(autoincrement())
  cargo String

  tutorId Int?
  tutor   Tutor? @relation(fields: [tutorId], references: [id], onDelete: Cascade)

  colaboradorId Int?
  colaborador   Colaborador? @relation(fields: [colaboradorId], references: [id], onDelete: Cascade)

  @@map("cargo")
}
